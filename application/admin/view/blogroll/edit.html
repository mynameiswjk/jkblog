<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>文章列表--layui后台管理模板 2.0</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="__COMMON__/layui/css/layui.css" media="all" />
</head>
<body>
  <blockquote class="layui-elem-quote layui-text" id='blockquote'>
  友情链接的添加
</blockquote>
<form class="layui-form layui-form-pane" action="">
  <div class="layui-form-item">
    <label class="layui-form-label">友链名称</label>
    <div class="layui-input-block">
      <input type="text" name="blogroll_name" value="{$blogroll.blogroll_name}"   autocomplete="off" lay-verify="blogroll_name" placeholder="请输入友链名称" class="layui-input">
    </div>
  </div> 
  <div class="layui-form-item">
    <label class="layui-form-label">友链URL</label>
    <div class="layui-input-block">
      <input type="text" name="blogroll_url"  value="{$blogroll.blogroll_url}"   autocomplete="off" lay-verify="blogroll_url" placeholder="请输入友链URL" class="layui-input">
    </div>
  </div> 
  <div class="layui-upload" style='margin:0 0 20px 15px;'>
  <div class="layui-upload-list" style='width: 100px;height: 100px;margin: 0 10px 10px 0;border:1px solid #8072725e;'>
     {if !empty($blogroll.blogroll_logo)}
       <img class="layui-upload-img" id="blogroll_logo"  src="{$blogroll.blogroll_logo}" style='whdth:100%;height:100%;'>
    {else}
       <img class="layui-upload-img" id="blogroll_logo"  style='whdth:100%;height:100%;'>
    {/if}
  </div>
 <button type="button" class="layui-btn" id="test1">上传Logo</button>
 <input type='hidden' name='blogroll_logo'  lay-verify="blogroll_logo"value='{$blogroll.blogroll_logo}'/>
</div> 
  <div class="layui-form-item" pane="">
    <label class="layui-form-label">是否显示</label>
    <div class="layui-input-block">
      <input type="radio" name="is_show" value="1" title="是"   
        {if $blogroll.is_show eq 1}checked{/if}
      />
      <input type="radio" name="is_show" value="0" title="否"  
        {if $blogroll.is_show eq 0}checked{/if}
      />
    </div>
  </div>
 
  <div class="layui-form-item">
    <button class="layui-btn" lay-submit="" lay-filter="demo2" style="margin-left: 20px;">提交</button>
  </div>
</form>

<script type="text/javascript" src="__COMMON__/layui/layui.js"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
layui.use(['form', 'layedit', 'laydate','upload'], function(){
  var form = layui.form
  ,layer = layui.layer
  ,layedit = layui.layedit
  ,laydate = layui.laydate;
   var $ = layui.jquery
  ,upload = layui.upload;
  //普通图片上传
  var loading;
  var uploadInst = upload.render({
    elem: '#test1'
    ,url: '{:url("Setting/settingUpload")}'
    ,before:function(){
     loading = top.layer.msg('图片上传中',{icon: 16,time:false,shade:0.8});
    }
    ,done: function(res){
      top.layer.close(loading);
      if(res.code == 200) {
          $("#blogroll_logo").attr('src',res.file_url);
          $("input[name='blogroll_logo']").val(res.file_url);
      }else{
          layer.msg(res.msg,{icon:2});
      }
    }
    ,error: function(){
      //演示失败状态，并实现重传
   
    },exts: 'png|jpg|jpeg'
     ,size : 10240
  });
  //自定义验证规则
  form.verify({
   blogroll_name: function(value){
      if(value.length  == 0){
        return '请输入友情链接名称';
      }
      if(value.length  > 30){
        return '友情链接名称必须小于30位';
      }
    }
    ,blogroll_url: function(value){
      if(value.length  == 0){
        return '请输入友情链接地址';
      }
      var reg=/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)(([A-Za-z0-9-~]+)\.)+([A-Za-z0-9-~\/])+$/;
      if(!reg.test(value)){
        return 'URL格式不正确';
     }
    },blogroll_logo: function(value){
      if(value.length  == 0){
        return '请上传logo图片';
      }
    }
    ,content: function(value){
      layedit.sync(editIndex);
    }
  });
  
  //监听提交
  form.on('submit(demo2)', function(data){
    var index = top.layer.msg('数据提交中，请稍候',{icon: 16,time:false,shade:0.8});
    var field  = data.field;
    var is_show = $("input[name='is_show']:checked").val();
    $.post("{:url('Blogroll/editBlogroll')}",{
        blogroll_id   :  "{$blogroll.blogroll_id}",
        blogroll_name :  field.blogroll_name,
        blogroll_url  :  field.blogroll_url,
        blogroll_logo :  field.blogroll_logo,
        is_show       :  is_show,
    },function(res){
          if(res.code == 200) {
            top.layer.msg(res.msg,{icon:1,time:2000},function(){
                    top.layer.close(index);
                    layer.closeAll("iframe");
                    parent.location.reload();
            });
          }else{
                top.layer.msg(res.msg,{icon:2});
          }
      }
      ,'json');

    return false;
  });
});
</script>

</body>
</html>